---
page_type: sample
products:
- office-outlook
- office-365
languages:
- javascript
description: В этом примере показано, как использовать клиентский токен с сервера Exchange для проверки подлинности пользователей вашей почтовой надстройки для Outlook.
extensions:
  contentType: samples
  technologies:
  - Add-ins
  createdDate: 8/14/2015 12:52:42 PM
---
# Надстройка Outlook: использование маркера удостоверения клиента

**Содержание**

* [Сводка](#summary)
* [Предварительные требования](#prerequisites)
* [Ключевые компоненты примера](#components)
* [Описание кода](#codedescription)
* [Сборка и отладка](#build)
* [Устранение неполадок](#troubleshooting)
* [Вопросы и комментарии](#questions)
* [Дополнительные ресурсы](#additional-resources)

<a name="summary"></a>
## Сводка
В этом примере показано, как использовать клиентский токен с сервера Exchange для проверки подлинности пользователей вашей почтовой надстройки для Outlook. 

<a name="prerequisites"></a>
## Предварительные требования ##

Для этого примера требуются приведенные ниже компоненты.  

  - Visual Studio 2013 (обновление 5) или Visual Studio 2015 с инструментами разработчика Microsoft Office. 
  - Компьютер с Exchange 2013 и по крайней мере одной учетной записью электронной почты или учетной записью Office 365. Вы можете [присоединиться к Программе разработчика Office 365 и получить бесплатную годовую подписку на Office 365](https://aka.ms/devprogramsignup).
  - Любой браузер, поддерживающий ECMAScript 5.1, HTML5 и CSS3, например Internet Explorer 9, Chrome 13, Firefox 5, Safari 5.0.6 или более поздние версии этих браузеров.
  - Microsoft.Exchange.WebServices.Auth.dll, Microsoft.IdentityModel.dll и Microsoft.IdentityModel.Extensions.dll. Необходимые пакеты можно установить в консоли диспетчера пакетов (**инструменты > Диспетчер пакетов NuGet > консоль диспетчера пакетов**): — install-Package EWS — API-2,1 
	- Установочный пакет Microsoft.IdentityModel  
	- Установить-пакет Microsoft.Identity.Model.Extensions  
  - [ASP.NET MVC 4](http://www.asp.net/mvc/mvc4).
  - Опыт программирования на JavaScript и работы с веб-службами.

<a name="components"></a>
## Ключевые компоненты примера
Пример решения содержит следующие ключевые файлы:

**UseIdentityToken** проект

- [```UseIdentityToken.xml```](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-UseIdentityToken/blob/master/UseIdentityToken/UseIdentityTokenManifest/UseIdentityToken.xml): Файл манифеста для почтовой надстройки для Outlook.

**UseIdentityTokenWeb** проект

- [```AppRead/Home/Home.html```](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-UseIdentityToken/blob/master/UseIdentityTokenWeb/AppRead/Home/Home.html): Пользовательский интерфейс HTML для надстройки.
- [```AppRead/Home/Home.js```](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-UseIdentityToken/blob/master/UseIdentityTokenWeb/AppRead/Home/Home.js): Логика, которая обрабатывает запрос и использование токена идентификации.

**UseIdentityTokenService** проект

- [```App_Start/WebApiConfig.cs```](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-UseIdentityToken/blob/master/UseIdentityTokenService/App_Start/WebApiConfig.cs): Связывает маршрутизацию по умолчанию для службы Web API.
- [```Controllers/IdentityTokenController.cs```](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-UseIdentityToken/blob/master/UseIdentityTokenService/Controllers/IdentityTokenController.cs): Сервисный объект, который предоставляет бизнес-логику для примера сервиса Web API.
- [```Models/ServiceRequest.cs```](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-UseIdentityToken/blob/master/UseIdentityTokenService/Models/ServiceRequest.cs): Объект, представляющий веб-запрос. Содержимое объекта создается из объекта запроса JSON, отправленного из надстройки.
- [```Models/ServiceResponse.cs```](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-UseIdentityToken/blob/master/UseIdentityTokenService/Models/ServiceResponse.cs): Объект, представляющий ответ от веб-службы. Содержимое объекта сериализуется в объект JSON при отправке обратно в надстройку.

<a name="codedescription"></a>
## Описание
кода В этом примере показано, как использовать клиентский токен с сервера Exchange для проверки подлинности пользователей вашей почтовой надстройки.
Сервер Exchange выдает токен, который является уникальным для почтового ящика на сервере. Вы можете использовать этот токен, чтобы связать почтовый ящик с сервисами, которые вы предоставляете для почтовой надстройки.

Образец разделен на две части:  
- Почтовая надстройка для Outlook, которая работает в вашем почтовом клиенте. Он запрашивает токен идентификации с сервера Exchange и отправляет этот токен веб-службе.
- Веб-сервис, который обрабатывает запрос от клиента.

Веб-служба использует следующие шаги для обработки токена:

- Проверяет токен, чтобы убедиться, что он был отправлен с сервера Exchange и что токен был предназначен для этой почтовой надстройки.
- Выполняет поиск в локальном словаре, чтобы определить, использовался ли ранее уникальный идентификатор. Если уникальный идентификатор не использовался, служба запрашивает учетные данные (имя пользователя и пароль службы) у клиента. Если уникальный идентификатор присутствует в кэше токена, служба отправляет ответ.
- Если запрос содержит учетные данные (то есть это ответ на запрос учетных данных), служба сохраняет имя пользователя службы в кэше токена с уникальным идентификатором из токена в качестве своего ключа.

Этот образец никоим образом не проверяет имя пользователя и пароль службы. Запрос учетных данных считается действительным, если он содержит как имя пользователя, так и пароль. Учетные данные не истекают из кэша в этом примере; однако все кэшированные идентификаторы и имена пользователей теряются при прекращении работы примера приложения.

В этом примере требуется действительный сертификат сервера на сервере Exchange. Если сервер Exchange использует самозаверяющий сертификат по умолчанию, вам необходимо добавить сертификат в локальное хранилище доверенных сертификатов. Вы можете найти [инструкции по экспорту и установке самозаверяющего сертификата](http://social.technet.microsoft.com/wiki/contents/articles/13898.how-to-export-a-self-signed-server-certificate-and-import-it-on-a-another-server-in-windows-server-2008-r2.aspx) в TechNet.


<a name="build"></a>
## Сборка и отладка ##
Надстройка будет активирована для любого сообщения электронной почты в папке «Входящие» пользователя. Вы можете упростить тестирование надстройки, отправив одно или несколько сообщений электронной почты в свою тестовую учетную запись перед запуском образца.

1. Откройте решение в Visual Studio и нажмите F5, чтобы построить пример. 
2. Подключитесь к учетной записи Exchange, указав адрес электронной почты и пароль для сервера Exchange 2013, и разрешите серверу настроить учетную запись электронной почты.  
3. В браузере войдите в систему с учетной записью электронной почты, введя имя учетной записи и пароль.  
4. Выберите сообщение в папке Входящие и нажмите **Использовать маркер идентификации** на панели надстроек, которая отображается над сообщением.  
5. Нажмите кнопку **Отправить уникальный идентификатор Exchange для обслуживания**, чтобы отправить запрос на сервер Exchange.  
6. Сервер предложит вам войти в систему. Вы можете ввести что-нибудь в сервис имя пользователя и пароль. Этот образец не проверяет содержимое текстовых полей.  
7. Снова нажмите кнопку **Отправить уникальный идентификатор Exchange для обслуживания**. На этот раз ответ возвращается с сервера без запроса имени пользователя и пароля.  

Если у вас есть другое сообщение электронной почты в папке Входящие, вы можете переключиться на это сообщение электронной почты, показать надстройку **Использовать маркер идентификации** и снова нажать кнопку. The response will be returned from the server without a request for a user name or password.


<a name="troubleshooting"></a>
## Устранение неполадок
При использовании Outlook Web App для проверки почтовой надстройки для Outlook могут возникнуть следующие проблемы:

- Панель надстроек не отображается при выборе сообщения. В этом случае перезапустите надстройку, выбрав **Отладка - Остановить отладку** в окне Visual Studio, затем нажмите клавишу F5, чтобы перестроить и развернуть надстройку.  
- Изменения в коде JavaScript могут не учитываться при развертывании и запуске надстройки. Если изменения не получены, очистите кэш в веб-браузере, выбрав **Сервис - Свойства обозревателя** и нажав кнопку **Удалить**. Удалите временные файлы Интернета, а затем перезапустите надстройку.

Если надстройка загружается, но не запускается, попробуйте собрать решение в Visual Studio (**Build> Build Solution**). Проверьте список ошибок на наличие недостающих зависимостей и добавьте их при необходимости.

<a name="questions"></a>
## Вопросы и комментарии

- Если у вас возникли проблемы с запуском этого примера, [сообщите о неполадке](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-UseIdentityToken/issues).
- Вопросы о разработке надстроек Office в целом следует размещать в [Stack Overflow](http://stackoverflow.com/questions/tagged/office-addins). Обязательно помечайте свои вопросы и комментарии тегом [office-addins].

<a name="additional-resources"></a>
## Дополнительные ресурсы
- [надстройки Office](https://msdn.microsoft.com/library/office/jj220060.aspx) документации в MSDN
- [Web API: Официальный сайт Microsoft ASP.NET](http://www.asp.net/web-api)  
- [Аутентификация почтовой надстройки с помощью токенов Exchange 2013](http://msdn.microsoft.com/library/c0520a1e-d9ba-495a-a99f-6816d7d2a23e)  
- [Дополнительные примеры надстроек](https://github.com/OfficeDev?utf8=%E2%9C%93&query=-Add-in)

## Авторские права
(c) Корпорация Майкрософт (Microsoft Corporation), 2015. Все права защищены.


Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [часто задаваемых вопросов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).
